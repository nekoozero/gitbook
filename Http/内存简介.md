# 内存简介

内存（Memory）是程序与 CPU 进行沟通的桥梁。计算机中所有的程序运行都是在内存中进行的。作用是存放 CPU 中的运算数据，以及与硬盘等外部存储设备交换的数据。主存的运行决定了计算机的稳定运行。

内存的内部是由各种 IC 电路组成的，它的种类很庞大，但是其主要分为三种存储器：

- 随机存储器（RAM）：内存中最重要的一种，表示既可以 从中读取数据，也可以写入数据。当机器关闭时，内存中的信息会丢失。
- 只读存储器（ROM）：ROM 一般只能用于数据的读取，不能写入数据，但是当机器停电时，这些数据不会丢失。

- 高速缓存（Cache）：它分为**一级缓存（L1 Cache）、二级缓存（L2 Cache）、三级缓存（L3 Cache）**这些数据，它位于内存和 CPU 之间，是一个读写速度比内存更好的存储器。当 CPU 向内存写入数据时，这些数据也会被写入高速缓存中。当 CPU 需要读取数据时，会直接从高速缓存中直接读取，如果需要的数据在 Cache 中没有，CPU 会再去读取内存的数据。

内存 IC 是一个完整的结构，它内部也有电源、地址信号、数据信号、控制信号和用于寻址的 IC 引脚来进行数据的读写。

![001a7e1ecf739c4a64779064674d3f20.png](http://www.qxnekoo.cn:8888/images/2020/08/12/001a7e1ecf739c4a64779064674d3f20.png)

## 寄存器

存储器的顶层是 CPU 中的寄存器，它们用和 CPU 一样的材料制成，所以和 CPU 一样快，程序必须在软件中自行管理这些寄存器（即决定如何使用它们）。

## 高速缓存

多数由硬件控制，使用最频繁的高速缓存行保存在位于 CPU 内部或非常靠近 CPU 的高速缓存中。当应用程序从内存中读取关键词时，高速缓存的硬件会检查所需要的高速缓存行是否在高速缓存中。如果在的话，那么就**高速缓存命中**（**cache hit**）。高速缓存满足了该请求，并且没有通过总线将内存请求发送到主内存。

高速缓存命中通常需要花费两个时钟周期。缓存未命中需要从内存中提取，这会消耗大量的时间，高速缓存行会限制容量的大小因为它的造价非常昂贵，每一级高速缓存比前一级慢且容量更大。

现代 CPU 设计了两种缓存，第一级缓存或者说是 L1 cache 总是位于 CPU 内部，用来将已解码的指令调入 CPU 的执行引擎。对于那些频繁使用的关键字，多数芯片有第二个 L1 cache。典型的 L1 cache 的大小为 16KB。另外，往往还设有二级缓存，也就是 L2 cache，用来存放最近使用过的关键字，一般是兆字节为单位。它们之间最大的不同在于是否存在延迟。访问 L1 cache 没有任何的延迟，然而访问 L2 cache 会有 1-2 个时钟周期的延后。

> 时钟周期：计算机处理器或 CPU 的速度由时钟周期来确定，该时钟周期使振荡器两个脉冲之间的时间量。一般而言，每秒脉冲越高，计算机处理器处理信息的速度越快。时钟速度以 Hz 为单位测量，通常为兆赫（MHz）或千兆赫（GHz）。例如，一个 4 GHz 处理器每秒执行 4,000,000,000 个时钟周期。
>
> 计算机处理器可以在每个时钟周期执行一条或多条指令，这具体取决于处理器的类型。早期的计算机处理器和较慢的 CPU 在每个时钟周期只能执行一条指令，而现代处理器在没个时钟周期可以执行多条指令。

## 磁盘

磁盘的问题是随机访问数据时间大约慢了三个数量级，原因是磁盘的构造不同。

磁盘是一种机械装置，一个磁盘中有一个或多个金属盘片，它们会旋转，信息会写在磁盘一系列的同心圆上。在任意一个给定臂的位置，每个磁头可以读取一段环形区域，称为**磁道（track）**，把一个给定臂的位置上的所有磁道合并起来，组成了一个**柱面（cylinder）**。

> 固态硬盘不是磁盘，**固态硬盘（Solid State Disk,SSD）**并没有可以移动的部分。外形也不像唱片，并且数据是存储在**存储器（闪存）**中。

虚拟内存机制：使得期望运行的存储空间大于实际的物理存储空间，其方法是将程序放在磁盘上，而将主存作为一部分缓存，用来保存最频繁使用的部分程序，这种机制需要快速映像内存地址，用来把程序生成的地址转换为有关字节在 RAM 中的物理地址。这种映像由 CPU 中的一个称为**存储器管理单元**（Memory Management Unit,MMU）的部件来完成。

![CPU84468c481855e074.png](http://www.qxnekoo.cn:8888/images/2020/08/12/CPU84468c481855e074.png)

缓存和 MMU 的出现是对系统的性能有很重要的影响，在多道程序系统中，从一个程序切换到另一个程序的机制称为**上下文切换**，对来自缓存中的资源进行修改并把其写回磁盘是很有必要的。









