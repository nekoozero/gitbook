# HTTP通信

HTTP 协议用于客户端和服务器之间的通信。

在两台计算机之间使用 HTTP 协议通信时，在一条通信线路上必定有一端是客户端，另一端则是服务器端。
有时候，按实际情况，两台计算机作为客户端和服务器端的角色有可能会互换。但就仅从一条通信路线来说，**服务器端和客户端的角色是确定的**，而用 HTTP 协议能够明确区分哪端是客户端，哪端是服务器端。 

请求报文示例：

![http_request.png](http://www.qxnekoo.cn:8888/images/2020/05/26/http_request.png)

返回报文示例：

![http_response.png](http://www.qxnekoo.cn:8888/images/2020/05/26/http_response.png)

## HTTP 是不保存状态的协议

即**无状态协议**。自身不对请求和响应之间的通信状态进行保存。这是为了更快地处理大量事务，确保协议的可伸缩性，而特意把 HTTP 协议设 计成如此简单的。

HTTP/1.1 虽然是无状态协议，但为了实现期望的保持状态功能，于是引入了 **Cookie** 技术。有了 Cookie 再用 HTTP 协议通信，就可以管理状态了。

## HTTP 方法

- GET ：获取资源 

- POST：传输实体主体

- PUT：传输文件 

- HEAD：获得报文首部 

  HEAD 方法和 GET 方法一样，只是不返回报文主体部分。用于确认 URI 的有效性及资源更新的日期时间等。

- DELETE：删除文件 

- OPTIONS：询问支持的方法 

  OPTIONS 方法用来查询针对请求 URI 指定的资源支持的方法。

- TRACE：追踪路径

  TRACE 方法是让 Web 服务器端将之前的请求通信环回给客户端的方 法。
  发送请求时，在 Max-Forwards 首部字段中填入数值，每经过一个服务器端就将该数字减 1，当数值刚好减到 0 时，就停止继续传输，最后接收到请求的服务器端则返回状态码 200 OK 的响应。 

- CONNECT：要求用隧道协议连接代理

  CONNECT 方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行 TCP 通信。主要使用 SSL（Secure Sockets Layer，安全套接层）和 TLS（Transport Layer Security，传输层安全）协议把通信内容加密后经网络隧道传输。 

## 持久连接节省通信量

HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。

> 比如，使用浏览器浏览一个包含多张图片的 HTML 页面时，在发送请求访问 HTML 页面资源的同时，也会请求该 HTML 页面里包含的其他资源。因此，每次的请求都会造成无谓的 TCP 连接建立和断开，增加通信量的开销。

提出了持久连接（HTTP Persisent Connections,也称为 HTTP keep-alive 或 HTTP connection reuse）的方法。特点：只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。

![Keep-alive.png](http://www.qxnekoo.cn:8888/images/2020/05/27/Keep-alive.png)

减少了 TCP 连接的重复建立和断开造成的额外开销，减轻了服务器端的负载，提高了页面的响应速度。

## 管线化

以前发送请求后续等待响应才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求。

这样就能够同事并行发送多个请求，而不需要一个接一个地等待响应了。

## Cookie

无状态协议当然也有它的优点。由于不必保存状态，自然可减少服务器的 CPU 及内存资源的消耗。从另一侧面来说，也正是因为 HTTP 协议本身是非常简单的，所以才会被应用在各种场景里。

Cookie 技术通过一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。下次客户端会自动在请求报文中加入 Cookie 值后发出去。

服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

![cookie_simple.png](http://www.qxnekoo.cn:8888/images/2020/05/27/cookie_simple.png)























