# CPU简介

CPU 的全称是 Central Processing Unit，是计算机的大脑。

从程序或应用程序获取指令并执行计算。此过程可以分为三个关键阶段：**提取、解码和执行**。CPU 从系统的 RAM 中提取指令，然后解码该指令的实际内容，然后再由 CPU 的相关部分执行该指令。

> RAM：随机存取存储器（Random Access Memory），也叫主存，是与 CPU 直接交换数据的内部存储器，可以随时读写（刷新时除外），而且速度很快，通常作为操作系统或其他正在运行中的程序的**临时数据存储介质**。
>
> CPU 的执行周期：从内存中提取第一条指令、解码并决定它的类型和操作数，执行，然后再提取、解码执行后续的指令。

![CPU.png](http://www.qxnekoo.cn:8888/images/2020/08/11/CPU.png)



CPU 主要由两部分构成：**控制单元**和**算术逻辑单元**

- 控制单元：从内存中提取指令并解码执行
- 算术逻辑单元（ALU）：处理算数和逻辑运算

CPU 是计算机得心脏和大脑，他和内存都是许多晶体管组成得电子部件。接收数据输入，执行指令并处理信息，与输入输出设备进行通信，这些设备向 CPU 发送数据和从 CPU 接收数据。

从功能来看，CPU 的内部由**寄存器、控制器、运算器和时钟**四部分组成，各部分之间通过电信号连通。

![CPU.png](http://www.qxnekoo.cn:8888/images/2020/08/12/CPU.png)

- **寄存器**是中央处理器内的组成部分。它们可以用来暂存指令、数据和地址。可以将其看作是内存的一种。根据种类的不同，一个 CPU 内部会有 20 - 100 个寄存器。
- **控制器**负责把内存上的指令、数据读入寄存器，并根据指令的结果控制计算机。
- **运算器**负责运算从内存中读入寄存器的数据。
- **时钟**负责发出 CPU 开始计时的时钟信号。

> 计算机所有程序的运行都是在内存中进行的，内存又称为主存，其作用是存放 CPU 中的运算数据，以及与硬盘等外部存储设备交换的数据。只要计算机在运行中，CPU 就会把需要运算的数据调到主存中进行运算，当运算完成后 CPU 再将结果传送出来，主存的运行也决定了计算机的稳定运行。
>
> 主存通过控制芯片来与 CPU 进行相连，由可读写的元素构成，每个字节（1 byte = 8 bits）都带有一个地址编号，注意是一个字节，而不是一个位。CPU 通过地址从主存中读取数据和指令，也可以根据地址写入数据。当计算机关闭时，内存中的指令和数据也会被清除。

由于访问内存获取数据要比执行指令花费的时间长,因此所有的 CPU 内部都会包含一些**寄存器**来保存关键变量和临时结果。

因此指令集中通常会有一些指令用于把关键字从内存中加载到寄存器中，以及把关键字从寄存器存入到内存中。还有一些其他的指令会把来自寄存器和内存的操作数进行组合。

除了保存变量和临时结果的通用结果。还有几个特殊的寄存器。

1. 程序计数器：指示下一条需要从内存提取指令的地址。之后，程序计数器会更新为下一条需要提取的地址。
2. 堆栈指针：指向内存中当前栈的顶端。堆栈指针会包含输入过程中的有关参数、局部变量以及没有保存在寄存器中的临时变量。
3. PSW（程序状态字寄存器）：是由操作系统维护的 8 个字节（64 位）long 类型的数据集合。除非发生系统结束，否则可以忽略 PSW，但通常只能写入某些字段。PSW 在系统调用和 IO 中起着重要作用。

操作系统必须了解所有的寄存器，在时间多路复用的 CPU 中，操作系统往往停止一个程序转而运行另外一个。每次当操作系统停止运行一个程序时，操作系统会保存所有寄存器的值，以便于后续重新运行该程序。

## CPU 指令执行过程

几乎所有冯 诺伊曼的 CPU，其工作都可以分为 5 个阶段：取指令、指令译码、执行指令、访存取数、结果写回。

- 取指令：将内存中的指令读取到 CPU 中寄存器的过程，程序寄存器用于存储吓一跳指令所在的地址。
- 指令译码：在取指令完成后，立马进入指令译码阶段，在指令译码阶段，指令译码器按照预定的指令格式，对取回的指令进行拆分和解释，识别区分出不同的指令类别以及各种获取操作数的方法。
- 执行指令：译码完成后，就需要执行一条指令了，此阶段的任务是完成指令所规定的各种操作，具体实现指令的功能。
- 访问取数：根据指令的需要，有可能需要从内存中提取数据，此阶段的任务是：根据指令地址码，得到操作数在主存中的地址，并从主存中读取该操作数用于运算。
- 结果写回：作为最后一个阶段，结果写回阶段把执行指令阶段的运行结果数据写回到某种存储形式：结果数据经常被写到 CPU 的内部寄存器中，以便被后续的指令快速地存取。

















