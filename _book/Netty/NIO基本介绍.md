# NIO基本介绍

> 时间：2020/8/3

1. NIO 是 JDK1.4 提供的新 API，是同步非阻塞的。
2. 相关类放在了 java.nio 包下，并且对原 java.io 包中的很多类进行改写。
3. 三大核心部分：**Channel（通道）、Buffer（缓冲区）、Selector（选择器）**。
4. NIO 是面向缓冲区（块）编程的。数据读取到一个它稍后处理的缓冲区，需要时可在缓冲区中前后移动，这就增加了处理过程中的灵活性，使用它可以提供非阻塞式的高伸缩性网络。
5. NIO 的非阻塞模式，是一个线程从某通道发送请求或者读取数据，但是它仅能得到目前可用的数据，如果目前没有数据可用时，就什么都不会获取，**而不是保持线程阻塞**，所以直至数据变的可以读取之前，该线程可以继续做其他的事情，非阻塞写也是如此，一个线程请求写入一些数据到某通道，但不需要等待它完全写入，这个线程同时可以去做别的事情。
6. NIO 是可以做到用一个线程来处理多个操作的。假设有 1000 个请求过来，可以分配 50 或者 100 个线程来处理。不像之前的阻塞 IO 那样，必须分配 1000 个。
7. HTTP2.0 使用了多路复用的技术，做到用一个连接并发处理多个请求，而且请求的数量比 HTTP1.1 大了好几个数量级。

## NIO 和 BIO 比较

- BIO 以流的方式处理数据，而 NIO 以块的方式处理数据，块 IO 的效率比流 IO 高很多。
- BIO 是阻塞的，NIO 则是非阻塞的。
- BIO 基于字节流和字符流进行操作，而 NIO 基于 Channel（通道） 和 Buffer（缓冲区） 进行操作，数据总是从通道读取到缓冲区中，或者从缓存区写入到通道中。Selector（选择器） 用于监听多个通道的事件（连接请求、数据到达等），因此使用单个线程就可以监听到多个客户端通道。

## 三大核心原理

关系图：

![nio.png](http://www.qxnekoo.cn:8888/images/2020/08/02/nio.png)

1. 每个 channel 都会对应一个 Buffer。
2. Selector 对应一个线程，一个线程对应多个 channel。
3. 程序切换到哪个 channel 是由事件决定的，Event 就是一个重要的概念。
4. Selector 会根据不同的事件，在各个通道上切换。
5. Buffer 就是一个内存块，底层是一个数组。
6. 数据的读写是通过 Buffer，BIO 中要么是输入流，或者是输出流，不能双向，但是 NIO 的 Buffer 是可以读也可以写，需要 flip 方法切换。channel 是双向的，可以返回底层操作系统的情况。

